
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C6 RPA Orchestrator</title>
    
    <!-- TAILWIND CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- REACT & REACT DOM (CDN) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- BABEL (Para compilar JSX no navegador) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- FONTES -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&family=Fira+Code:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #020617;
            color: #f8fafc;
        }
        .font-mono {
            font-family: 'Fira Code', monospace;
        }
        
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.2.3/",
    "react": "https://esm.sh/react@^19.2.3",
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0"
  }
}
</script>

</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // ==========================================
        // 1. ÍCONES (SVG Components)
        // ==========================================
        const PythonIcon = () => (
            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M14.25.18l.9.2.73.26.59.33.45.38.34.44.25.51.15.58.06.64v2.54h-3.41l-.45.03-.39.08-.34.13-.29.2-.23.25-.17.33-.11.41-.03.49v2.66h-3.41l-.49-.03-.41-.11-.33-.17-.25-.23-.2-.29-.13-.34-.08-.39-.03-.45V6.78l.03-.58.11-.53.19-.48.27-.42.35-.35.42-.27.48-.19.53-.11.58-.03h5.72zM9.75 23.82l-.9-.2-.73-.26-.59-.33-.45-.38-.34-.44-.25-.51-.15-.58-.06-.64v-2.54h3.41l.45-.03.39-.08.34-.13.29-.2.23-.25.17-.33.11-.41.03-.49v-2.66h3.41l.49.03.41.11.33.17.25.23.2.29.13.34.08.39.03.45v3.66l-.03.58-.11.53-.19.48-.27.42-.35.35-.42.27-.48.19-.53.11-.58.03H9.75z"/></svg>
        );
        const CheckIcon = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
        );
        const AlertIcon = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        );
        const ClockIcon = () => (
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        );
        const PlayIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
        );
        const StopIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="4" width="16" height="16" rx="2"/></svg>
        );
        const PauseIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
        );
        const SparklesIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3l1.912 5.813a2 2 0 001.275 1.275L21 12l-5.813 1.912a2 2 0 00-1.275 1.275L12 21l-1.912-5.813a2 2 0 00-1.275-1.275L3 12l5.813-1.912a2 2 0 001.275-1.275L12 3z"/></svg>
        );
        const ActivityIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        );

        // ==========================================
        // 2. TYPES & CONSTANTS (Adapted to JS)
        // ==========================================
        const JobStatus = {
            RUNNING: 'RUNNING',
            SUCCESS: 'SUCCESS',
            ERROR: 'ERROR',
            FAILED: 'FAILED',
            DISABLED: 'DISABLED',
            NO_DATA: 'NO_DATA',
            SCHEDULED: 'SCHEDULED',
            IDLE: 'IDLE'
        };

        // ==========================================
        // 3. COMPONENTS
        // ==========================================

        const AutomationCard = ({ script, onRun, onStop }) => {
            // Lógica de Próxima Execução
            const getNextExecution = () => {
                if (script.next_run_text) return script.next_run_text;
                return '---';
            };

            const nextExecText = getNextExecution();

            // Estilização baseada no Status
            const getStatusStyle = () => {
                switch (script.status) {
                    case JobStatus.RUNNING: return 'border-blue-500 shadow-[0_0_20px_rgba(59,130,246,0.2)] bg-[#0F1219]';
                    case JobStatus.SUCCESS: return 'border-green-600/50 bg-[#0F1219]';
                    case JobStatus.ERROR:
                    case JobStatus.FAILED: return 'border-red-600/50 bg-[#1a0f0f]';
                    case JobStatus.NO_DATA: return 'border-yellow-600/50 bg-[#1a160f]';
                    case JobStatus.SCHEDULED: return 'border-slate-500/50 bg-[#0F1219]';
                    default: return 'border-slate-800 bg-[#0F1219]';
                }
            };

            const formatTimestamp = (ts) => {
                if (!ts) return '--:--:--';
                try {
                    const date = new Date(ts);
                    if (isNaN(date.getTime())) return '--:--:--';
                    return date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                } catch { return '--:--:--'; }
            };

            const progressPercent = Math.min(100, Math.max(0, (script.daily_runs / (script.target_runs || 1)) * 100));

            return (
                <div className={`w-full h-[280px] rounded-2xl border-2 flex flex-col p-5 transition-all duration-300 relative group hover:scale-[1.02] ${getStatusStyle()}`}>
                    {script.status === JobStatus.RUNNING && (
                        <span className="absolute top-4 right-4 flex h-3 w-3">
                            <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                            <span className="relative inline-flex rounded-full h-3 w-3 bg-blue-500"></span>
                        </span>
                    )}

                    <div className="flex justify-between items-start mb-3">
                        <div className="flex items-center gap-2">
                            <div className={`p-2 rounded-lg ${script.status === JobStatus.RUNNING ? 'bg-blue-500/20 text-blue-400' : 'bg-slate-800 text-slate-400'}`}>
                                <PythonIcon />
                            </div>
                            <div className="flex flex-col">
                                <span className="text-[10px] font-black text-slate-500 uppercase tracking-widest leading-none mb-1">
                                    {script.area_name}
                                </span>
                                <div className={`text-[10px] font-bold uppercase px-2 py-0.5 rounded w-fit ${
                                    script.status === JobStatus.RUNNING ? 'bg-blue-600 text-white' : 
                                    script.status === JobStatus.SUCCESS ? 'bg-green-900/40 text-green-400' :
                                    script.status === JobStatus.ERROR ? 'bg-red-900/40 text-red-400' :
                                    'bg-slate-800 text-slate-500'
                                }`}>
                                    {script.status}
                                </div>
                            </div>
                        </div>
                    </div>

                    <h3 className="text-white font-bold text-base leading-tight mb-4 line-clamp-2 h-10" title={script.script_name}>
                        {script.script_name.replace(/_/g, ' ')}
                    </h3>

                    <div className="flex-1 space-y-3">
                        <div className="bg-black/20 rounded-lg p-2.5 border border-white/5 flex justify-between items-center">
                            <div>
                                <div className="text-[9px] font-bold text-slate-500 uppercase">Última Execução</div>
                                <div className="text-xs font-mono text-slate-300">{formatTimestamp(script.last_execution?.timestamp)}</div>
                            </div>
                            <div className="text-right">
                                <div className="text-[9px] font-bold text-slate-500 uppercase">Status</div>
                                <div className="flex items-center justify-end gap-1">
                                    {script.last_execution?.status === 'SUCCESS' ? <CheckIcon /> : 
                                     script.last_execution?.status?.includes('ERROR') ? <AlertIcon /> : null}
                                    <span className={`text-[10px] font-bold ${
                                        script.last_execution?.status === 'SUCCESS' ? 'text-green-500' : 
                                        script.last_execution?.status?.includes('ERROR') ? 'text-red-500' : 'text-slate-500'
                                    }`}>
                                        {script.last_execution?.status || '---'}
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div className="flex items-center gap-2 text-slate-500 px-1">
                            <ClockIcon />
                            <span className="text-[10px] font-bold uppercase">
                                Próxima: <span className={nextExecText === 'Amanhã' ? 'text-orange-400' : 'text-blue-400'}>{nextExecText}</span>
                            </span>
                        </div>

                        <div className="space-y-1 px-1">
                            <div className="flex justify-between text-[9px] font-black text-slate-600 uppercase">
                                <span>Runs Hoje</span>
                                <span>{script.daily_runs} / {script.target_runs}</span>
                            </div>
                            <div className="w-full bg-slate-800 h-1.5 rounded-full overflow-hidden">
                                <div 
                                    className={`h-full transition-all duration-1000 ${script.status === JobStatus.ERROR ? 'bg-red-500' : 'bg-blue-600'}`}
                                    style={{ width: `${progressPercent}%` }}
                                />
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-2 gap-2 mt-3 pt-3 border-t border-white/5">
                        <button 
                            onClick={() => onRun(script.id)}
                            disabled={script.status === JobStatus.RUNNING}
                            className="bg-blue-600 hover:bg-blue-500 disabled:bg-slate-800 disabled:text-slate-600 disabled:cursor-not-allowed text-white py-2 rounded-lg text-[10px] font-black transition-all flex items-center justify-center gap-2 shadow-lg shadow-blue-900/20 active:scale-95"
                        >
                            <PlayIcon /> RUN
                        </button>
                        <button 
                            onClick={() => onStop(script.id)}
                            disabled={script.status !== JobStatus.RUNNING}
                            className="bg-slate-800 hover:bg-red-900/40 disabled:opacity-50 disabled:hover:bg-slate-800 text-slate-400 hover:text-red-400 py-2 rounded-lg text-[10px] font-black transition-all border border-white/5 active:scale-95 flex items-center justify-center gap-2"
                        >
                            <StopIcon /> STOP
                        </button>
                    </div>
                </div>
            );
        };

        // ==========================================
        // 4. MAIN APP LOGIC
        // ==========================================

        const App = () => {
            const { useState, useEffect, useCallback, useRef, useMemo } = React;

            const [activeArea, setActiveArea] = useState('MONITOR');
            const [isSyncPaused, setIsSyncPaused] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            
            // Initial Data
            // Initial Data - Empty
            const [scripts, setScripts] = useState([]);

            const [stats, setStats] = useState({
                lastDiscovery: Date.now(),
                nextDiscovery: Date.now() + 60000,
                lastBqSync: Date.now(),
                nextBqSync: Date.now() + 300000,
                bqVerified: false,
                concurrentRunning: 0,
                queueSize: 0
            });

            const fetchData = async () => {
                try {
                    const res = await fetch('/api/status');
                    const data = await res.json();
                    if (data.scripts) setScripts(data.scripts);
                    if (data.stats) {
                         setStats({
                            ...data.stats,
                            // Convert backend timestamps (seconds usually) to millis if needed, or stick to consistency
                            // The backend sends unix timestamp in seconds for discovery/bq
                            nextDiscovery: data.stats.nextDiscovery * 1000, 
                            nextBqSync: data.stats.nextBqSync * 1000,
                            concurrentRunning: data.stats.concurrentRunning,
                            queueSize: data.stats.queueSize,
                            bqVerified: data.stats.bqVerified
                         });
                         setIsSyncPaused(data.stats.paused);
                    }
                } catch (err) {
                    console.error("API Fetch Error", err);
                }
            };

            const togglePause = async () => {
                try {
                    await fetch('/api/pause', { method: 'POST' });
                    fetchData(); // Immediate refresh
                } catch(e) { console.error(e); }
            };

            const handleRunManual = async (id) => {
                try {
                     await fetch('/api/run', { 
                        method: 'POST', 
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({id})
                     });
                     fetchData();
                } catch(e) { console.error(e); }
            };

            const handleStop = async (id) => {
               try {
                     await fetch('/api/stop', { 
                        method: 'POST', 
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({id})
                     });
                     fetchData();
                } catch(e) { console.error(e); }
            };

            // Polling
            useEffect(() => {
                fetchData();
                const interval = setInterval(fetchData, 1000);
                return () => clearInterval(interval);
            }, []);

            const uniqueAreas = useMemo(() => Array.from(new Set(scripts.map(s => s.area_name))).sort(), [scripts]);

            const filteredScripts = useMemo(() => {
                let result = scripts;
                if (activeArea !== 'MONITOR') {
                    result = result.filter(s => s.area_name === activeArea);
                }
                if (searchTerm) {
                    const term = searchTerm.toLowerCase();
                    result = result.filter(s => s.script_name.toLowerCase().includes(term) || s.area_name.toLowerCase().includes(term));
                }
                return result;
            }, [activeArea, scripts, searchTerm]);

            const runningScripts = useMemo(() => filteredScripts.filter(s => s.status === JobStatus.RUNNING), [filteredScripts]);
            
            const upcomingScripts = useMemo(() => {
                const hour = new Date().getHours();
                return filteredScripts
                    .filter(s => s.active && s.next_run_text && s.next_run_text.includes(":"))
                    .map(s => {
                        return { ...s, next_run_display: s.next_run_text };
                    })
                    //.sort((a, b) => a.nextHour - b.nextHour); // Simpler sort might needed or just rely on backend order?
                    // We can just take the first 5
                    .slice(0, 5);
            }, [filteredScripts]);

            const historyScripts = useMemo(() => {
                return filteredScripts
                    .filter(s => s.last_execution)
                    .sort((a, b) => {
                        const tA = new Date(a.last_execution?.timestamp || 0).getTime();
                        const tB = new Date(b.last_execution?.timestamp || 0).getTime();
                        return tB - tA;
                    });
            }, [filteredScripts]);

            const getSecondsRemaining = (timestamp) => {
                if (isSyncPaused) return 0;
                return Math.max(0, Math.floor((timestamp - Date.now()) / 1000));
            };

            // --- RENDERIZAÇÃO DO APP (JSX) ---
            return (
                <div className="flex h-screen bg-[#020617] text-slate-200 overflow-hidden font-sans selection:bg-blue-500/30">
                    
                    {/* SIDEBAR */}
                    <aside className="w-[280px] bg-[#0F1219] border-r border-white/5 flex flex-col shadow-2xl z-30">
                        <div className="p-8 border-b border-white/5 bg-slate-950/50">
                            <div className="flex items-center gap-3">
                                <div className="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center font-black text-xl text-white shadow-lg shadow-blue-600/20">C6</div>
                                <div className="flex flex-col">
                                    <h1 className="font-black text-xs tracking-tighter leading-none uppercase text-white">CÉLULA PYTHON</h1>
                                    <span className="text-[9px] text-blue-500 font-bold tracking-widest uppercase mt-0.5">MONITORAÇÃO</span>
                                </div>
                            </div>
                        </div>

                        <nav className="flex-1 p-4 space-y-1 overflow-y-auto custom-scrollbar">
                            <button
                                onClick={() => setActiveArea('MONITOR')}
                                className={`w-full flex items-center justify-between px-4 py-3 rounded-xl transition-all mb-6 group ${
                                    activeArea === 'MONITOR' 
                                        ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/30' 
                                        : 'text-slate-400 hover:bg-white/5 hover:text-white'
                                }`}
                            >
                                <div className="flex items-center gap-3">
                                    <ActivityIcon />
                                    <span className="text-xs font-bold uppercase tracking-wider">Monitor Geral</span>
                                </div>
                                {activeArea === 'MONITOR' && <span className="w-1.5 h-1.5 bg-white rounded-full animate-pulse"></span>}
                            </button>

                            <div className="px-4 mb-2">
                                <p className="text-[10px] font-black text-slate-600 uppercase tracking-widest">Áreas</p>
                            </div>
                            
                            {uniqueAreas.map(area => (
                                <button
                                    key={area}
                                    onClick={() => setActiveArea(area)}
                                    className={`w-full flex items-center justify-between px-4 py-2.5 rounded-lg transition-all ${
                                        activeArea === area 
                                            ? 'bg-slate-800 text-blue-400 border border-blue-500/20' 
                                            : 'text-slate-500 hover:bg-white/5 hover:text-slate-300'
                                    }`}
                                >
                                    <span className="text-xs font-bold uppercase tracking-wider truncate">{area}</span>
                                    <span className={`text-[9px] font-bold px-1.5 py-0.5 rounded ${
                                        activeArea === area ? 'bg-blue-900/40 text-blue-300' : 'bg-slate-900 text-slate-600'
                                    }`}>
                                        {scripts.filter(s => s.area_name === area).length}
                                    </span>
                                </button>
                            ))}
                        </nav>

                        <div className="p-5 bg-slate-950/80 space-y-4 border-t border-white/5 backdrop-blur-sm">
                            <button 
                                onClick={togglePause}
                                className={`w-full py-3 rounded-xl flex items-center justify-center gap-2 font-black text-[10px] uppercase tracking-widest transition-all border ${
                                    isSyncPaused 
                                        ? 'bg-orange-900/20 border-orange-500/50 text-orange-400 animate-pulse' 
                                        : 'bg-slate-800 border-slate-700 text-slate-400 hover:bg-slate-700 hover:text-white'
                                }`}
                            >
                                {isSyncPaused ? <PlayIcon /> : <PauseIcon />}
                                {isSyncPaused ? 'RETOMAR SYNC' : 'PAUSAR SYNC'}
                            </button>

                            <div className={`space-y-3 transition-opacity duration-300 ${isSyncPaused ? 'opacity-40 grayscale' : 'opacity-100'}`}>
                                <div className="space-y-1">
                                    <div className="flex justify-between text-[9px] font-black text-slate-500 uppercase tracking-widest">
                                        <span>BigQuery Sync</span>
                                        <span className="text-blue-500 font-mono">{getSecondsRemaining(stats.nextBqSync)}s</span>
                                    </div>
                                    <div className="w-full bg-slate-900 h-1 rounded-full overflow-hidden">
                                        <div 
                                            className="h-full bg-blue-600 transition-all duration-1000 ease-linear"
                                            style={{ width: `${(1 - getSecondsRemaining(stats.nextBqSync) / 300) * 100}%` }} 
                                        />
                                    </div>
                                </div>
                                <div className="space-y-1">
                                    <div className="flex justify-between text-[9px] font-black text-slate-500 uppercase tracking-widest">
                                        <span>Excel Discovery</span>
                                        <span className="text-yellow-600 font-mono">{getSecondsRemaining(stats.nextDiscovery)}s</span>
                                    </div>
                                    <div className="w-full bg-slate-900 h-1 rounded-full overflow-hidden">
                                        <div 
                                            className="h-full bg-yellow-600 transition-all duration-1000 ease-linear"
                                            style={{ width: `${(1 - getSecondsRemaining(stats.nextDiscovery) / 60) * 100}%` }} 
                                        />
                                    </div>
                                </div>
                            </div>
                            
                            <div className="flex items-center gap-2 pt-1 border-t border-white/5 mt-2">
                                <div className={`w-1.5 h-1.5 rounded-full ${isSyncPaused ? 'bg-orange-500' : 'bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]'}`} />
                                <span className={`text-[9px] font-black uppercase tracking-widest ${isSyncPaused ? 'text-orange-500' : 'text-slate-500'}`}>
                                    {isSyncPaused ? 'SINCRONIZAÇÃO PAUSADA' : 'SISTEMA OPERACIONAL'}
                                </span>
                            </div>
                        </div>
                    </aside>

                    {/* MAIN AREA */}
                    <main className="flex-1 flex flex-col bg-[#0B0E14] relative overflow-hidden">
                        
                        <header className="px-8 py-6 flex justify-between items-end bg-gradient-to-b from-[#0F1219] to-[#0B0E14] border-b border-white/5 z-20">
                            <div>
                                <div className="flex items-center gap-3 mb-1">
                                    <h2 className="text-2xl font-black text-white tracking-tighter uppercase">
                                        {activeArea === 'MONITOR' ? 'Painel de Controle' : activeArea}
                                    </h2>
                                    <span className="px-2 py-0.5 rounded bg-slate-800 border border-slate-700 text-[10px] font-bold text-slate-400 uppercase">
                                        {activeArea === 'MONITOR' ? 'Visão Global' : 'Filtro Ativo'}
                                    </span>
                                </div>
                                <div className="flex items-center gap-2 text-slate-500 text-[10px] font-bold uppercase tracking-wider">
                                    {isSyncPaused ? (
                                        <span className="text-orange-500 flex items-center gap-1"><AlertIcon /> Atualização automática desativada pelo usuário</span>
                                    ) : (
                                        <span className="text-blue-500 flex items-center gap-1"><CheckIcon /> Atualização em tempo real ativa</span>
                                    )}
                                </div>
                            </div>

                            <div className="flex items-center gap-4">
                                <div className="relative group">
                                    <input 
                                        type="text" 
                                        placeholder="Buscar script..." 
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        className="bg-[#161B22] border border-slate-800 text-white text-xs font-medium rounded-lg px-4 py-2.5 w-64 focus:outline-none focus:border-blue-500 transition-all"
                                    />
                                </div>

                                <div className="flex gap-3">
                                    <div className="bg-[#161B22] px-4 py-2 rounded-lg border border-slate-800 flex flex-col items-center min-w-[80px]">
                                        <span className="text-[9px] font-black text-slate-500 uppercase tracking-wider">Fila</span>
                                        <span className="text-lg font-black text-white leading-none mt-1">{stats.queueSize}</span>
                                    </div>
                                    <div className="bg-[#161B22] px-4 py-2 rounded-lg border border-slate-800 flex flex-col items-center min-w-[80px]">
                                        <span className="text-[9px] font-black text-slate-500 uppercase tracking-wider">Threads</span>
                                        <span className="text-lg font-black text-blue-400 leading-none mt-1">{stats.concurrentRunning}/5</span>
                                    </div>
                                </div>
                            </div>
                        </header>

                        {runningScripts.length > 0 && (
                            <div className="bg-blue-900/10 border-b border-blue-500/10 px-8 py-2 flex items-center gap-4 overflow-x-auto scrollbar-hide shrink-0">
                                <span className="text-[9px] font-black text-blue-400 uppercase tracking-widest whitespace-nowrap flex items-center gap-2">
                                    <span className="relative flex h-2 w-2">
                                        <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                                        <span className="relative inline-flex rounded-full h-2 w-2 bg-blue-500"></span>
                                    </span>
                                    Executando:
                                </span>
                                <div className="flex gap-3">
                                    {runningScripts.map(s => (
                                        <div key={s.id} className="bg-blue-900/20 px-3 py-1 rounded border border-blue-500/20 flex items-center gap-2 whitespace-nowrap animate-in slide-in-from-right duration-300">
                                            <span className="text-[10px] font-bold text-blue-100 uppercase">{s.script_name}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        <div className="flex-1 overflow-y-auto p-8 custom-scrollbar">
                            <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6 pb-20">
                                {filteredScripts.map(script => (
                                    <AutomationCard key={script.id} script={script} onRun={handleRunManual} onStop={handleStop} />
                                ))}
                            </div>
                            
                            {filteredScripts.length === 0 && (
                                <div className="flex flex-col items-center justify-center h-[50vh] text-slate-700 opacity-50">
                                    <SparklesIcon />
                                    <p className="mt-4 font-black uppercase tracking-widest text-xs">Nenhum script encontrado para este filtro</p>
                                </div>
                            )}
                        </div>
                    </main>

                    {/* RIGHT PANEL */}
                    <aside className="w-[380px] bg-[#0F1219] border-l border-white/5 flex flex-col shadow-xl z-30">
                        <div className="flex-[0.4] flex flex-col min-h-0 border-b border-white/5">
                            <div className="p-5 pb-2">
                                <div className="flex items-center justify-between mb-3">
                                    <div className="flex items-center gap-2">
                                        <div className="text-blue-500"><ClockIcon /></div>
                                        <div>
                                            <h3 className="text-xs font-black text-white uppercase tracking-widest leading-none">Próximos</h3>
                                            <p className="text-[9px] text-slate-500 font-bold uppercase mt-0.5">Fila Cronológica (Hoje)</p>
                                        </div>
                                    </div>
                                    <span className="text-[9px] bg-slate-800 text-slate-400 px-1.5 py-0.5 rounded font-bold">{upcomingScripts.length}</span>
                                </div>
                            </div>
                            
                            <div className="flex-1 overflow-y-auto px-5 pb-4 space-y-2 custom-scrollbar">
                                {upcomingScripts.length === 0 ? (
                                    <div className="text-center py-10 opacity-30">
                                        <span className="text-[10px] font-black text-slate-500 uppercase">Sem agendamentos pendentes</span>
                                    </div>
                                ) : (
                                    upcomingScripts.map(s => (
                                        <div key={s.id} className="group bg-[#161B22]/50 p-3 rounded-lg border border-white/5 hover:border-blue-500/30 transition-all flex items-center justify-between">
                                            <div className="overflow-hidden">
                                                <div className="text-[10px] font-bold text-slate-200 uppercase truncate group-hover:text-blue-400 transition-colors">{s.script_name}</div>
                                                <div className="text-[9px] font-bold text-slate-600 uppercase">{s.area_name}</div>
                                            </div>
                                            <div className="text-right min-w-[50px]">
                                                <div className="text-blue-400 text-xs font-black font-mono">{s.next_run_display}</div>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>

                        <div className="flex-[0.6] flex flex-col min-h-0">
                            <div className="p-5 pb-2">
                                <div className="flex items-center justify-between mb-3">
                                    <div className="flex items-center gap-2">
                                        <div className="text-green-500"><CheckIcon /></div>
                                        <div>
                                            <h3 className="text-xs font-black text-white uppercase tracking-widest leading-none">Histórico</h3>
                                            <p className="text-[9px] text-slate-500 font-bold uppercase mt-0.5">Execuções de Hoje</p>
                                        </div>
                                    </div>
                                    <span className="text-[9px] bg-slate-800 text-slate-400 px-1.5 py-0.5 rounded font-bold">{historyScripts.length}</span>
                                </div>
                            </div>

                            <div className="flex-1 overflow-y-auto px-5 pb-4 space-y-2 custom-scrollbar">
                                {historyScripts.length === 0 ? (
                                    <div className="text-center py-10 opacity-30">
                                        <span className="text-[10px] font-black text-slate-500 uppercase">Nenhuma execução registrada</span>
                                    </div>
                                ) : (
                                    historyScripts.map(s => (
                                        <div key={s.id} className="bg-[#161B22]/50 p-3 rounded-lg border border-white/5 flex items-center justify-between hover:bg-[#161B22]">
                                            <div className="flex items-center gap-3 overflow-hidden">
                                                <div className={`mt-0.5 ${s.last_execution?.status === 'SUCCESS' ? 'text-green-500' : 'text-red-500'}`}>
                                                    {s.last_execution?.status === 'SUCCESS' ? <CheckIcon /> : <AlertIcon />}
                                                </div>
                                                <div className="overflow-hidden">
                                                    <div className="text-[10px] font-bold text-slate-300 uppercase truncate">{s.script_name}</div>
                                                    <div className="flex items-center gap-2 text-[9px] text-slate-600 font-bold uppercase">
                                                        <span>{s.area_name}</span>
                                                        <span className="text-slate-700">•</span>
                                                        <span>{s.last_execution?.duration}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="text-right pl-2">
                                                <div className="text-[9px] font-mono text-slate-500">
                                                    {new Date(s.last_execution?.timestamp || 0).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                                                </div>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>
                    </aside>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
